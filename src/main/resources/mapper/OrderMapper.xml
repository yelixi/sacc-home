<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.sacc.SaccHome.mapper.OrderMapper">

    <resultMap id="BaseResultMap" type="org.sacc.SaccHome.pojo.Order">
        <id property="id" column="id"></id>
        <result column="start_time" jdbcType="TIMESTAMP" property="start_time" />
        <result column="end_time" jdbcType="TIMESTAMP" property="end_time" />
        <result column="number" jdbcType="INTEGER" property="number" />
        <result column="name_list" jdbcType="VARCHAR" property="name_list" />
        <result column="user_id" jdbcType="INTEGER" property="user_id" />
        <result column="created_at" jdbcType="TIMESTAMP" property="created_at" />
        <result column="updated_at" jdbcType="TIMESTAMP" property="updated_at" />
    </resultMap>
    <!--查询七天内的预约-->
    <select id="findNextWeek" resultMap="BaseResultMap">
        SELECT * FROM `order` WHERE To_Days(start_time) - To_Days(current_timestamp()) &lt;= 7 AND To_Days(start_time) - To_Days(current_timestamp()) &gt;= 0;
    </select>

    <!--新增预约-->
    <insert id="save" parameterType="org.sacc.SaccHome.pojo.Order" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO `order` (start_time,end_time,number,name_list,user_id,created_at,updated_at)
        VALUES (#{start_time},#{end_time},#{number},#{name_list},#{user_id},current_timestamp(),current_timestamp());
    </insert>

    <!--查询是否存在重复的时间段-->
    <select id="judgeTimeCorrect" parameterType="org.sacc.sacchome.entity.Order" resultMap="BaseResultMap">
        SELECT * FROM `order` WHERE
            (start_time &gt;= #{start_time} AND start_time &lt; #{end_time}) OR
            (start_time &lt;= #{start_time} AND end_time &gt;= #{end_time}) OR
            (end_time &gt;= #{start_time} AND end_time &lt;= #{end_time})
    </select>
</mapper>



